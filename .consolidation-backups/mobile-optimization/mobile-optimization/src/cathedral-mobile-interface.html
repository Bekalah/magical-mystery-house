<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cathedral Mobile Interface | Professional iPad/Android Studio</title>
    <style>
        /* Mobile-First Cathedral Design - Optimized for iPad/Android */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0d0b12 0%, #1a1527 50%, #0d0b12 100%);
            color: #f4d03f;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Mobile Header - Fixed for iOS Safari */
        .mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(13, 11, 18, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #f4d03f;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .mobile-logo {
            font-size: 1.2em;
            font-weight: bold;
            color: #f4d03f;
        }

        .mobile-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #32cd32;
        }

        .battery-level {
            font-size: 0.8em;
            color: #6de0e0;
        }

        /* Main Mobile Interface */
        .mobile-main {
            position: fixed;
            top: 60px;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
        }

        /* Studio Selector - Touch Optimized */
        .studio-selector {
            background: rgba(26, 21, 39, 0.9);
            padding: 15px;
            border-bottom: 1px solid #8a7fff;
        }

        .studio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
        }

        .studio-card {
            background: linear-gradient(135deg, rgba(138, 127, 255, 0.3), rgba(109, 224, 224, 0.2));
            border: 2px solid #8a7fff;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .studio-card:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, rgba(244, 208, 63, 0.4), rgba(138, 127, 255, 0.4));
        }

        .studio-card.active {
            border-color: #f4d03f;
            background: linear-gradient(135deg, rgba(244, 208, 63, 0.3), rgba(255, 159, 190, 0.3));
        }

        .studio-icon {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .studio-name {
            font-size: 0.85em;
            font-weight: 600;
            color: #f4d03f;
            margin-bottom: 3px;
        }

        .studio-frequency {
            font-size: 0.7em;
            color: #6de0e0;
        }

        /* Main Canvas Area */
        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: radial-gradient(circle, rgba(13, 11, 18, 0.8), rgba(26, 21, 39, 0.9));
        }

        .main-canvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        /* Tool Palette - Mobile Optimized */
        .tool-palette {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(13, 11, 18, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #f4d03f;
            padding: 15px;
            z-index: 1000;
        }

        .tool-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 10px;
        }

        .tool-button {
            background: linear-gradient(135deg, #8a7fff, #6de0e0);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-button:active {
            transform: scale(0.9);
        }

        .tool-button.active {
            background: linear-gradient(135deg, #f4d03f, #ff9fbe);
            box-shadow: 0 0 20px rgba(244, 208, 63, 0.5);
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .control-slider {
            flex: 1;
            height: 6px;
            background: rgba(138, 127, 255, 0.3);
            border-radius: 3px;
            -webkit-appearance: none;
            appearance: none;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #f4d03f;
            border-radius: 50%;
            cursor: pointer;
        }

        .control-label {
            font-size: 0.8em;
            color: #6de0e0;
            min-width: 50px;
            text-align: center;
        }

        /* Performance Monitor */
        .performance-monitor {
            position: fixed;
            top: 70px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.8em;
            font-family: 'Courier New', monospace;
            color: #32cd32;
            z-index: 1001;
            display: none;
        }

        .performance-monitor.visible {
            display: block;
        }

        .fps-counter {
            color: #ff69b4;
        }

        .memory-usage {
            color: #ffd700;
        }

        /* Gesture Controls */
        .gesture-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(13, 11, 18, 0.9);
            border: 2px solid #8a7fff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: #f4d03f;
            font-size: 0.9em;
            z-index: 999;
            display: none;
        }

        .gesture-hint.visible {
            display: block;
        }

        /* Emergency Touch Exit */
        .touch-emergency {
            position: fixed;
            top: 50%;
            right: -60px;
            width: 60px;
            height: 40px;
            background: rgba(255, 0, 0, 0.9);
            border-radius: 20px 0 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
            transition: right 0.3s ease;
            z-index: 1000;
        }

        .touch-emergency:hover,
        .touch-emergency:active {
            right: 0;
        }

        /* Mobile-Optimized Modal */
        .mobile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .mobile-modal-content {
            background: linear-gradient(135deg, #1a1527, #2a1f37);
            border: 2px solid #f4d03f;
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
        }

        .mobile-modal h3 {
            color: #f4d03f;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .mobile-modal-button {
            background: linear-gradient(135deg, #8a7fff, #6de0e0);
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            color: white;
            font-size: 1em;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }

        .mobile-modal-button:active {
            transform: scale(0.98);
        }

        /* Mobile Swipe Navigation */
        .swipe-nav {
            position: fixed;
            bottom: 80px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .swipe-button {
            background: rgba(138, 127, 255, 0.8);
            border: 2px solid #8a7fff;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swipe-button:active {
            transform: scale(0.9);
        }

        /* Responsive Breakpoints */
        @media (max-width: 768px) {
            .studio-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .tool-button {
                width: 45px;
                height: 45px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .studio-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mobile-header {
                padding: 0 15px;
            }
            
            .studio-selector {
                padding: 12px;
            }
        }

        /* High-DPI Display Optimization */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .main-canvas {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: optimize-contrast;
            }
        }

        /* Landscape Orientation Optimization */
        @media (orientation: landscape) and (max-height: 500px) {
            .mobile-header {
                height: 50px;
            }
            
            .mobile-main {
                top: 50px;
            }
            
            .tool-palette {
                padding: 10px;
            }
            
            .tool-button {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="mobile-logo">üèõÔ∏è Cathedral</div>
        <div class="mobile-status">
            <div class="status-indicator" id="statusIndicator"></div>
            <div class="battery-level" id="batteryLevel">üîã100%</div>
        </div>
    </header>

    <!-- Main Mobile Interface -->
    <div class="mobile-main">
        <!-- Studio Selector -->
        <div class="studio-selector">
            <div class="studio-grid" id="studioGrid">
                <!-- Studios will be populated by JavaScript -->
            </div>
        </div>

        <!-- Main Canvas Area -->
        <div class="canvas-container">
            <canvas class="main-canvas" id="mainCanvas"></canvas>
            
            <!-- Gesture Hint -->
            <div class="gesture-hint" id="gestureHint">
                <div>üëÜ Tap to select tools</div>
                <div>üëÜüëÜ Double-tap to create</div>
                <div>üëÜüëÜüëÜ Triple-tap to undo</div>
                <div>üì± Pan to navigate workspace</div>
                <div>ü§è Pinch to zoom</div>
            </div>
        </div>

        <!-- Tool Palette -->
        <div class="tool-palette">
            <div class="tool-row">
                <div class="tool-button active" data-tool="select" title="Select Tool">üëÜ</div>
                <div class="tool-button" data-tool="brush" title="Sacred Geometry Brush">üñåÔ∏è</div>
                <div class="tool-button" data-tool="merkabah" title="Merkaba Builder">‚¨¢</div>
                <div class="tool-button" data-tool="frequency" title="Frequency Visualizer">üéµ</div>
                <div class="tool-button" data-tool="export" title="Export">üì§</div>
            </div>
            
            <div class="control-row">
                <div class="control-label">Size</div>
                <input type="range" class="control-slider" id="sizeSlider" min="1" max="50" value="10">
                <div class="control-label" id="sizeValue">10</div>
            </div>
            
            <div class="control-row">
                <div class="control-label">Opacity</div>
                <input type="range" class="control-slider" id="opacitySlider" min="10" max="100" value="80">
                <div class="control-label" id="opacityValue">80%</div>
            </div>
        </div>
    </div>

    <!-- Performance Monitor -->
    <div class="performance-monitor" id="performanceMonitor">
        <div>FPS: <span class="fps-counter" id="fpsCounter">60</span></div>
        <div>Memory: <span class="memory-usage" id="memoryUsage">45MB</span></div>
        <div>Active Objects: <span id="objectCount">0</span></div>
    </div>

    <!-- Touch Emergency Exit -->
    <div class="touch-emergency" onclick="showEmergencyExit()">
        ESC
    </div>

    <!-- Swipe Navigation -->
    <div class="swipe-nav">
        <div class="swipe-button" onclick="togglePerformanceMonitor()" title="Performance">‚ö°</div>
        <div class="swipe-button" onclick="showSettings()" title="Settings">‚öôÔ∏è</div>
        <div class="swipe-button" onclick="helpGesture()" title="Help">‚ùì</div>
    </div>

    <!-- Settings Modal -->
    <div class="mobile-modal" id="settingsModal" style="display: none;">
        <div class="mobile-modal-content">
            <h3>‚öôÔ∏è Settings</h3>
            <button class="mobile-modal-button" onclick="togglePerformanceMode()">üîã Battery Saver</button>
            <button class="mobile-modal-button" onclick="toggleTouchFeedback()">üì≥ Haptic Feedback</button>
            <button class="mobile-modal-button" onclick="setAutoSave()">üíæ Auto-Save</button>
            <button class="mobile-modal-button" onclick="showAbout()">‚ÑπÔ∏è About</button>
            <button class="mobile-modal-button" onclick="closeSettings()">‚úÖ Done</button>
        </div>
    </div>

    <!-- Emergency Exit Modal -->
    <div class="mobile-modal" id="emergencyModal" style="display: none;">
        <div class="mobile-modal-content">
            <h3>üö® Emergency Exit</h3>
            <p style="color: #6de0e0; text-align: center; margin: 20px 0;">
                Return to Cathedral Professional Suite?
            </p>
            <button class="mobile-modal-button" onclick="exitToCathedral()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">
                üèõÔ∏è Exit to Desktop
            </button>
            <button class="mobile-modal-button" onclick="minimizeToBackground()" style="background: linear-gradient(135deg, #4ecdc4, #44a08d);">
                üì± Minimize
            </button>
            <button class="mobile-modal-button" onclick="closeEmergency()" style="background: linear-gradient(135deg, #6c757d, #495057);">
                Cancel
            </button>
        </div>
    </div>

    <script>
        // Mobile Cathedral Interface - Optimized for iPad/Android
        class MobileCathedralInterface {
            constructor() {
                this.currentStudio = 'visual-artist';
                this.currentTool = 'select';
                this.isDrawing = false;
                this.canvas = null;
                this.ctx = null;
                this.objects = [];
                this.performanceMode = false;
                this.lastFrameTime = 0;
                this.fps = 60;
                
                this.init();
            }

            init() {
                this.setupCanvas();
                this.populateStudios();
                this.setupTouchControls();
                this.setupGestures();
                this.startPerformanceMonitoring();
                this.checkDeviceCapabilities();
                this.showWelcomeGesture();
            }

            setupCanvas() {
                this.canvas = document.getElementById('mainCanvas');
                this.ctx = this.canvas.getContext('2d', {
                    alpha: false,
                    desynchronized: true,
                    powerPreference: 'default'
                });
                
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
            }

            resizeCanvas() {
                const container = document.querySelector('.canvas-container');
                const rect = container.getBoundingClientRect();
                
                // Set canvas size with device pixel ratio optimization
                const dpr = Math.min(window.devicePixelRatio || 1, 2); // Limit to 2x for performance
                this.canvas.width = rect.width * dpr;
                this.canvas.height = rect.height * dpr;
                this.canvas.style.width = rect.width + 'px';
                this.canvas.style.height = rect.height + 'px';
                
                this.ctx.scale(dpr, dpr);
                this.draw();
            }

            populateStudios() {
                const studios = [
                    { id: 'visual-artist', name: 'Visual Artist', icon: 'üé®', freq: 528 },
                    { id: 'mystic', name: 'Mystic', icon: 'üîÆ', freq: 852 },
                    { id: 'researcher', name: 'Researcher', icon: 'üß™', freq: 741 },
                    { id: 'scholar', name: 'Scholar', icon: 'üìö', freq: 741 },
                    { id: 'designer', name: 'Designer', icon: 'üé≠', freq: 528 },
                    { id: 'moonchild', name: 'Moonchild', icon: 'üåô', freq: 288 }
                ];

                const grid = document.getElementById('studioGrid');
                grid.innerHTML = '';

                studios.forEach(studio => {
                    const card = document.createElement('div');
                    card.className = 'studio-card';
                    if (studio.id === this.currentStudio) {
                        card.classList.add('active');
                    }
                    
                    card.onclick = () => this.selectStudio(studio.id);
                    card.innerHTML = `
                        <div class="studio-icon">${studio.icon}</div>
                        <div class="studio-name">${studio.name}</div>
                        <div class="studio-frequency">${studio.freq} Hz</div>
                    `;
                    
                    grid.appendChild(card);
                });
            }

            selectStudio(studioId) {
                this.currentStudio = studioId;
                
                // Update active state
                document.querySelectorAll('.studio-card').forEach(card => {
                    card.classList.remove('active');
                });
                event.target.closest('.studio-card').classList.add('active');
                
                // Update canvas based on studio
                this.objects = [];
                this.initializeStudioObjects();
                this.draw();
                
                // Show studio-specific hint
                this.showStudioHint(studioId);
            }

            initializeStudioObjects() {
                // Create studio-specific objects
                const objectCount = this.performanceMode ? 5 : 15;
                
                for (let i = 0; i < objectCount; i++) {
                    this.objects.push({
                        x: Math.random() * 300 + 50,
                        y: Math.random() * 200 + 50,
                        size: 20 + Math.random() * 30,
                        type: this.getStudioObjectType(),
                        frequency: this.getStudioFrequency(),
                        rotation: Math.random() * Math.PI * 2,
                        velocity: {
                            x: (Math.random() - 0.5) * 2,
                            y: (Math.random() - 0.5) * 2
                        }
                    });
                }
            }

            getStudioObjectType() {
                const types = {
                    'visual-artist': 'sacred-circle',
                    'mystic': 'merkaba',
                    'researcher': 'cube',
                    'scholar': 'sphere',
                    'designer': 'triangle',
                    'moonchild': 'hexagon'
                };
                return types[this.currentStudio] || 'circle';
            }

            getStudioFrequency() {
                const frequencies = {
                    'visual-artist': 528,
                    'mystic': 852,
                    'researcher': 741,
                    'scholar': 741,
                    'designer': 528,
                    'moonchild': 288
                };
                return frequencies[this.currentStudio] || 432;
            }

            setupTouchControls() {
                // Tool selection
                document.querySelectorAll('.tool-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.selectTool(button.dataset.tool);
                    });
                });

                // Control sliders
                document.getElementById('sizeSlider').addEventListener('input', (e) => {
                    document.getElementById('sizeValue').textContent = e.target.value;
                });

                document.getElementById('opacitySlider').addEventListener('input', (e) => {
                    document.getElementById('opacityValue').textContent = e.target.value + '%';
                });

                // Canvas interactions
                this.setupCanvasTouchControls();
            }

            setupCanvasTouchControls() {
                let touchStartX = 0;
                let touchStartY = 0;
                let lastTouchTime = 0;
                let tapCount = 0;

                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                    
                    const currentTime = Date.now();
                    if (currentTime - lastTouchTime < 300) {
                        tapCount++;
                    } else {
                        tapCount = 1;
                    }
                    lastTouchTime = currentTime;
                    
                    // Handle tap gestures
                    this.handleTapGesture(touch.clientX, touch.clientY, tapCount);
                });

                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.handlePanGesture(touchStartX, touchStartY, touch.clientX, touch.clientY);
                });

                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    tapCount = 0;
                });
            }

            handleTapGesture(x, y, tapCount) {
                const rect = this.canvas.getBoundingClientRect();
                const canvasX = x - rect.left;
                const canvasY = y - rect.top;

                switch (tapCount) {
                    case 1:
                        this.selectObject(canvasX, canvasY);
                        break;
                    case 2:
                        this.createObject(canvasX, canvasY);
                        break;
                    case 3:
                        this.undoLastAction();
                        break;
                }
            }

            handlePanGesture(startX, startY, endX, endY) {
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                if (distance > 10) { // Minimum distance to consider as pan
                    this.panView(deltaX, deltaY);
                }
            }

            selectTool(toolId) {
                this.currentTool = toolId;
                document.querySelectorAll('.tool-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tool="${toolId}"]`).classList.add('active');
                
                this.showToolHint(toolId);
            }

            setupGestures() {
                // Pinch to zoom
                let initialDistance = 0;
                let currentScale = 1;

                this.canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        const touch1 = e.touches[0];
                        const touch2 = e.touches[1];
                        initialDistance = Math.sqrt(
                            Math.pow(touch2.clientX - touch1.clientX, 2) +
                            Math.pow(touch2.clientY - touch1.clientY, 2)
                        );
                    }
                });

                this.canvas.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const touch1 = e.touches[0];
                        const touch2 = e.touches[1];
                        const distance = Math.sqrt(
                            Math.pow(touch2.clientX - touch1.clientX, 2) +
                            Math.pow(touch2.clientY - touch1.clientY, 2)
                        );
                        
                        const scale = distance / initialDistance;
                        this.zoomView(scale);
                    }
                });
            }

            zoomView(scale) {
                // Implement zoom logic
                this.draw();
            }

            panView(deltaX, deltaY) {
                // Implement pan logic
                this.draw();
            }

            selectObject(x, y) {
                // Check for object selection
                const selected = this.objects.find(obj => {
                    const distance = Math.sqrt(
                        Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2)
                    );
                    return distance < obj.size;
                });

                if (selected) {
                    this.showObjectInfo(selected);
                }
            }

            createObject(x, y) {
                const newObject = {
                    x: x,
                    y: y,
                    size: parseInt(document.getElementById('sizeSlider').value),
                    type: this.getStudioObjectType(),
                    frequency: this.getStudioFrequency(),
                    rotation: 0,
                    velocity: { x: 0, y: 0 }
                };

                this.objects.push(newObject);
                this.draw();
            }

            undoLastAction() {
                if (this.objects.length > 0) {
                    this.objects.pop();
                    this.draw();
                }
            }

            showObjectInfo(obj) {
                // Show object information modal
                console.log('Selected object:', obj);
            }

            showStudioHint(studioId) {
                const hints = {
                    'visual-artist': 'üé® Create with sacred geometry brushes',
                    'mystic': 'üîÆ Build merkaba structures',
                    'researcher': 'üß™ Analyze frequency patterns',
                    'scholar': 'üìö Study archetypal forms',
                    'designer': 'üé≠ Design with golden ratio',
                    'moonchild': 'üåô Explore lunar consciousness'
                };
                
                this.showTemporaryHint(hints[studioId]);
            }

            showToolHint(toolId) {
                const hints = {
                    'select': 'üëÜ Select and move objects',
                    'brush': 'üñåÔ∏è Draw sacred geometry',
                    'merkabah': '‚¨¢ Build 3D merkaba',
                    'frequency': 'üéµ Visualize sound',
                    'export': 'üì§ Save your work'
                };
                
                this.showTemporaryHint(hints[toolId]);
            }

            showTemporaryHint(text) {
                // Implementation for showing hints
            }

            showWelcomeGesture() {
                const hint = document.getElementById('gestureHint');
                hint.classList.add('visible');
                
                setTimeout(() => {
                    hint.classList.remove('visible');
                }, 5000);
            }

            checkDeviceCapabilities() {
                // Check for performance limitations
                const canvas = this.canvas;
                const isLowEnd = canvas.width * canvas.height > 5000000; // 5MP limit
                
                if (isLowEnd) {
                    this.performanceMode = true;
                    this.objects = this.objects.slice(0, 5); // Limit objects
                }

                // Check for haptic feedback support
                if ('vibrate' in navigator) {
                    document.body.classList.add('haptic-enabled');
                }
            }

            startPerformanceMonitoring() {
                const monitor = {
                    fps: 0,
                    frameCount: 0,
                    lastTime: performance.now(),
                    memoryUsage: 0
                };

                const updateMonitor = () => {
                    const now = performance.now();
                    const delta = now - monitor.lastTime;
                    
                    monitor.frameCount++;
                    
                    if (delta >= 1000) {
                        monitor.fps = Math.round((monitor.frameCount * 1000) / delta);
                        monitor.frameCount = 0;
                        monitor.lastTime = now;
                        
                        this.updatePerformanceDisplay(monitor);
                    }
                    
                    requestAnimationFrame(updateMonitor);
                };
                
                updateMonitor();
            }

            updatePerformanceDisplay(monitor) {
                const fpsElement = document.getElementById('fpsCounter');
                const memoryElement = document.getElementById('memoryUsage');
                const objectElement = document.getElementById('objectCount');
                
                if (fpsElement) fpsElement.textContent = monitor.fps;
                if (memoryElement) memoryElement.textContent = Math.round(performance.memory?.usedJSHeapSize / 1024 / 1024) + 'MB';
                if (objectElement) objectElement.textContent = this.objects.length;

                // Auto-enable performance mode if FPS drops
                if (monitor.fps < 30 && !this.performanceMode) {
                    this.enablePerformanceMode();
                }
            }

            enablePerformanceMode() {
                this.performanceMode = true;
                this.objects = this.objects.slice(0, 5);
                this.showTemporaryHint('üîã Performance mode enabled for smooth operation');
            }

            draw() {
                if (!this.ctx) return;
                
                const canvas = this.canvas;
                const ctx = this.ctx;
                const rect = canvas.getBoundingClientRect();
                
                // Clear canvas
                ctx.clearRect(0, 0, rect.width, rect.height);
                
                // Draw background gradient
                const gradient = ctx.createLinearGradient(0, 0, rect.width, rect.height);
                gradient.addColorStop(0, '#0d0b12');
                gradient.addColorStop(0.5, '#1a1527');
                gradient.addColorStop(1, '#0d0b12');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, rect.width, rect.height);
                
                // Draw objects
                this.objects.forEach(obj => {
                    this.drawObject(obj, ctx);
                });
                
                // Draw UI overlays
                this.drawUIOverlays(ctx);
            }

            drawObject(obj, ctx) {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                ctx.rotate(obj.rotation);
                
                const opacity = parseInt(document.getElementById('opacitySlider').value) / 100;
                ctx.globalAlpha = opacity;
                
                switch (obj.type) {
                    case 'sacred-circle':
                        this.drawSacredCircle(ctx, obj);
                        break;
                    case 'merkaba':
                        this.drawMerkaba(ctx, obj);
                        break;
                    case 'cube':
                        this.drawCube(ctx, obj);
                        break;
                    case 'sphere':
                        this.drawSphere(ctx, obj);
                        break;
                    case 'triangle':
                        this.drawTriangle(ctx, obj);
                        break;
                    case 'hexagon':
                        this.drawHexagon(ctx, obj);
                        break;
                    default:
                        this.drawCircle(ctx, obj);
                }
                
                ctx.restore();
            }

            drawSacredCircle(ctx, obj) {
                // Draw golden ratio spiral
                ctx.strokeStyle = '#f4d03f';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let angle = 0; angle < Math.PI * 4; angle += 0.1) {
                    const radius = (obj.size / 20) * Math.pow(1.618, angle / (Math.PI / 2));
                    const x = radius * Math.cos(angle);
                    const y = radius * Math.sin(angle);
                    
                    if (angle === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }

            drawMerkaba(ctx, obj) {
                // Draw merkaba (star tetrahedron)
                ctx.strokeStyle = '#8a7fff';
                ctx.lineWidth = 2;
                
                // Upward triangle
                ctx.beginPath();
                ctx.moveTo(0, -obj.size / 2);
                ctx.lineTo(obj.size / 2, obj.size / 2);
                ctx.lineTo(-obj.size / 2, obj.size / 2);
                ctx.closePath();
                ctx.stroke();
                
                // Downward triangle
                ctx.beginPath();
                ctx.moveTo(0, obj.size / 2);
                ctx.lineTo(-obj.size / 2, -obj.size / 2);
                ctx.lineTo(obj.size / 2, -obj.size / 2);
                ctx.closePath();
                ctx.stroke();
            }

            drawCube(ctx, obj) {
                // Simple cube representation
                ctx.strokeStyle = '#6de0e0';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const halfSize = obj.size / 2;
                ctx.rect(-halfSize, -halfSize, obj.size, obj.size);
                ctx.stroke();
            }

            drawSphere(ctx, obj) {
                // Draw sphere with gradient
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, obj.size / 2);
                gradient.addColorStop(0, '#ff9fbe');
                gradient.addColorStop(1, '#8a7fff');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(0, 0, obj.size / 2, 0, Math.PI * 2);
                ctx.fill();
            }

            drawTriangle(ctx, obj) {
                ctx.strokeStyle = '#32cd32';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const height = obj.size * 0.866; // equilateral triangle height
                ctx.moveTo(0, -height / 2);
                ctx.lineTo(-obj.size / 2, height / 2);
                ctx.lineTo(obj.size / 2, height / 2);
                ctx.closePath();
                ctx.stroke();
            }

            drawHexagon(ctx, obj) {
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < 6; i++) {
                    const angle = (i * Math.PI) / 3;
                    const x = (obj.size / 2) * Math.cos(angle);
                    const y = (obj.size / 2) * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.stroke();
            }

            drawCircle(ctx, obj) {
                ctx.strokeStyle = '#f4d03f';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, 0, obj.size / 2, 0, Math.PI * 2);
                ctx.stroke();
            }

            drawUIOverlays(ctx) {
                // Draw frequency display
                ctx.fillStyle = '#6de0e0';
                ctx.font = '14px monospace';
                ctx.fillText(`${this.getStudioFrequency()} Hz`, 10, 20);
                
                // Draw studio name
                ctx.fillStyle = '#f4d03f';
                ctx.font = '16px sans-serif';
                ctx.fillText(this.getStudioName(), 10, 40);
            }

            getStudioName() {
                const names = {
                    'visual-artist': 'Visual Artist',
                    'mystic': 'Mystic',
                    'researcher': 'Researcher',
                    'scholar': 'Scholar',
                    'designer': 'Designer',
                    'moonchild': 'Moonchild'
                };
                return names[this.currentStudio] || 'Cathedral';
            }

            // Animation loop
            animate() {
                this.updateObjects();
                this.draw();
                requestAnimationFrame(() => this.animate());
            }

            updateObjects() {
                this.objects.forEach(obj => {
                    obj.x += obj.velocity.x;
                    obj.y += obj.velocity.y;
                    obj.rotation += 0.01;
                    
                    // Boundary check
                    const canvas = this.canvas.getBoundingClientRect();
                    if (obj.x < 0 || obj.x > canvas.width) {
                        obj.velocity.x *= -1;
                    }
                    if (obj.y < 0 || obj.y > canvas.height) {
                        obj.velocity.y *= -1;
                    }
                });
            }
        }

        // Global functions for UI interactions
        function togglePerformanceMonitor() {
            const monitor = document.getElementById('performanceMonitor');
            monitor.classList.toggle('visible');
        }

        function showSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function helpGesture() {
            const hint = document.getElementById('gestureHint');
            hint.classList.add('visible');
            setTimeout(() => {
                hint.classList.remove('visible');
            }, 3000);
        }

        function showEmergencyExit() {
            document.getElementById('emergencyModal').style.display = 'flex';
        }

        function closeEmergency() {
            document.getElementById('emergencyModal').style.display = 'none';
        }

        function exitToCathedral() {
            window.location.href = '../../../apps/cathedral-professional-design-suite/index.html';
        }

        function minimizeToBackground() {
            // iOS PWA background behavior
            if ('serviceWorker' in navigator) {
                window.history.back();
            }
            closeEmergency();
        }

        function togglePerformanceMode() {
            // Toggle battery saver mode
            console.log('Performance mode toggled');
        }

        function toggleTouchFeedback() {
            // Toggle haptic feedback
            console.log('Touch feedback toggled');
        }

        function setAutoSave() {
            // Enable auto-save
            console.log('Auto-save enabled');
        }

        function showAbout() {
            alert('Cathedral Mobile Interface v1.0\nOptimized for iPad/Android\nMaster Artist Quality');
        }

        // Initialize mobile interface
        let mobileInterface;
        document.addEventListener('DOMContentLoaded', () => {
            mobileInterface = new MobileCathedralInterface();
            mobileInterface.animate();
        });

        // Handle orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (mobileInterface) {
                    mobileInterface.resizeCanvas();
                }
            }, 100);
        });

        // Handle visibility change (app background/foreground)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // App went to background
                console.log('App backgrounded');
            } else {
                // App came to foreground
                console.log('App foregrounded');
                if (mobileInterface) {
                    mobileInterface.draw();
                }
            }
        });
    </script>
</body>
</html>